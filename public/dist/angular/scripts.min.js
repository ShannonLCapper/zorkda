"use strict";!function(){angular.module("zorkdaApp",["ngRoute","ngAnimate","navbar","splashPage","landing","signIn","signUp","newGame","resumeGame","game"])}(),function(){angular.module("core",["ngCookies","ngAnimate","zorkdaSounds","streamText"])}(),function(){angular.module("game",["ngSanitize","luegg.directives","zorkdaSounds","core","saveModal"])}(),function(){angular.module("gameFileSelect",["core","ngAnimate"])}(),function(){angular.module("navbar",["core","settingsModal"])}(),function(){angular.module("landing",["core"])}(),function(){angular.module("resumeGame",["core","gameFileSelect"])}(),function(){angular.module("saveModal",["signIn","signUp","core","zorkdaForm"])}(),function(){angular.module("newGame",["core"])}(),function(){angular.module("settingsModal",["core","streamText"])}(),function(){angular.module("signIn",["zorkdaForm","core"])}(),function(){angular.module("signUp",["zorkdaForm","core"])}(),function(){angular.module("streamText",["ngSanitize"])}(),function(){angular.module("zorkdaForm",["core"])}(),function(){angular.module("zorkdaSounds",["ngAudio"])}(),function(){angular.module("splashPage",["core"])}(),function(){angular.module("zorkdaApp").config(["$locationProvider","$routeProvider","$httpProvider","$qProvider",function(e,n,t,r){t.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",r.errorOnUnhandledRejections(!1),e.hashPrefix(""),n.when("/",{template:"<splash-page><landing></landing></splash-page>"}).when("/sign-in",{template:"<splash-page><sign-in redirect='true'></sign-in></splash-page>"}).when("/sign-in/:error",{template:"<splash-page><sign-in redirect='true'></sign-in></splash-page>"}).when("/sign-up",{template:"<splash-page><sign-up redirect='true'></sign-up></splash-page>"}).when("/new-game",{template:"<splash-page><new-game></new-game></splash-page>"}).when("/resume-game",{template:"<splash-page><resume-game></resume-game></splash-page>"}).when("/game",{template:"<game></game>"}).otherwise("/sign-in")}])}();var bootstrapFocusFix={init:function(){$("body").on("mouseup","button, a[data-trigger!='focus'], input[type='submit']",function(){$(this).blur()})}};$(document).ready(function(){bootstrapFocusFix.init()}),function(){angular.module("zorkdaApp").controller("ZorkdaAppController",["$window",function(e){this.user={signedIn:!0,username:"scapper"},this.isMobileOrTablet=function(){var n=!1;return function(e){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(n=!0)}(e.navigator.userAgent||e.navigator.vendor||e.opera),n}}])}(),function(){angular.module("game").directive("game",["GameService","SettingsService","ZorkdaSounds","$sanitize","$timeout",function(e,n,t,r,i){return{restrict:"E",templateUrl:"assets/angular/game/game.html",scope:{},link:function(r,o,a){function u(e){r.outputs.push(e)}function s(e){u({text:e.outputLines,stream:!0,navi:e.navi,location:e.location})}function c(e){$.each(r.location,function(n,t){t[0]!==e[n]&&(t.shift(),t.push(e[n]))})}r.finishGameOutput=function(e){c(e.location),e.navi&&t.playSound("navi")},r.startGame=function(){r.retrievingGame=!0,r.retrievingGameError=!1,e.startGame().then(function(e){i(function(){$("#userInput").focus()}),c(e.data.location),r.gameStarted=!0,s(e.data)},function(e){var n;"404"===e.status?(n="Your game session expired. Please go back to resume from the nearest savepoint, or to start a new game.",r.canRetryRetrieve=!1):"400"===e.status?(n="Your game file ID didn't get sent in the request. Please go back and try loading the game again.",r.canRetryRetrieve=!1):(n="There was an error starting up your game. Try again in a moment.",r.canRetryRetrieve=!0),r.retrievingGameErrorMsg=n,r.retrievingGameError=!0}).finally(function(){r.retrievingGame=!1})},r.submitInput=function(){r.form.submitDisabled=!0,r.loadingOutputResponse=!0;var n=r.userInput;if(!n)return u({text:"Please type a command.",error:!0}),r.form.submitDisabled=!1,void(r.loadingOutputResponse=!1);r.userInput="",u({text:n,userSupplied:!0}),e.submitInput(n).then(function(e){s(e.data)},function(e){var n,t={error:!0};n=400===e.status?"Please type a command.":404===e.status?"Your game session has expired. Please go back to resume from the nearest savepoint, or to start a new game.":"There was an error on our end. Please try again in a moment.",t.text=n,u(t)}).finally(function(){r.form.submitDisabled=!1,r.loadingOutputResponse=!1})},r.$on("$locationChangeStart",function(e,n,t){if(r.game.loaded&&!r.game.saved){confirm("Are you sure you want to leave without saving?")||e.preventDefault()}}),r.location={area:[],room:[]},r.form={submitHover:!1,submitDisabled:!1},r.userInput="",r.outputs=[],r.settings=n.getSettings(),r.$watch(function(){return n.getSettings()},function(e){r.settings=e},!0),r.game=e.getGame(),r.$watch(function(){return e.getGame()},function(e,n){e!==n&&(r.game=e)},!0),r.gameStarted=!1,r.game.loaded&&r.startGame()}}}])}(),angular.module("gameFileSelect").animation(".game-file",function(){function e(e){return{height:e.prop("scrollHeight"),minHeight:e.css("minHeight"),maxHeight:e.css("maxHeight"),paddingTop:e.css("paddingTop"),paddingBottom:e.css("paddingBottom"),marginTop:e.css("marginTop"),marginBottom:e.css("marginBottom")}}function n(n,t){var r=e(n);return n.css({minHeight:0,height:0,paddingTop:0,paddingBottom:0,marginTop:0,marginBottom:0,opacity:0}).animate({minHeight:r.minHeight,height:r.height,paddingTop:r.paddingTop,paddingBottom:r.paddingBottom,marginTop:r.marginTop,marginBottom:r.marginBottom,opacity:1},function(){$(this).css("height","auto"),t()}),function(e){e&&n.stop()}}function t(n,t){var r=e(n);return n.css({minHeight:r.minHeight,height:r.height,paddingTop:r.paddingTop,paddingBottom:r.paddingBottom,marginTop:r.marginTop,marginBottom:r.marginBottom,opacity:1}).animate({minHeight:0,height:0,paddingTop:0,paddingBottom:0,marginTop:0,marginBottom:0,opacity:0},t),function(e){e&&n.stop()}}return{enter:n,move:n,leave:t}}),function(){angular.module("gameFileSelect").directive("gameFileSelect",["GameService",function(e){return{restrict:"E",scope:{gameFiles:"=",selectedGameId:"=",showNewFile:"=",selectCurrGame:"="},templateUrl:"assets/angular/game-file-select/game-file-select.html",link:function(n,t,r){n.selectCurrGame&&(n.currGame=e.getGame(),n.selectedGameId=n.currGame.savedGameId,n.$watch(function(){return e.getGame()},function(e,t){e!==t&&(n.currGame=e,n.selectedGameId=n.currGame.savedGameId)},!0),n.isCurrGame=function(e){return n.currGame.savedGameId===e})}}}])}(),function(){angular.module("navbar").directive("navbar",["UserService","GameService",function(e,n){return{restrict:"E",templateUrl:"assets/angular/navbar/navbar.html",scope:{},link:function(t,r,i){t.$watch(function(){return e.getUser()},function(e){t.user=e},!0),t.closeNav=function(e,n){$(".navbar-collapse").collapse("hide"),e&&e(n)},t.signOut=function(t){var r=n.getGame();if(r.loaded&&!r.saved){if(!confirm("Are you sure you want to sign out without saving your current game?"))return void t.preventDefault()}e.signOut()}}}}])}(),function(){angular.module("landing").directive("landing",["UserService",function(e){return{restrict:"E",templateUrl:"assets/angular/landing/landing.html",scope:{},link:function(n,t,r){n.$watch(function(){return e.getUser().signedIn},function(e){n.isSignedIn=e},!0)}}}])}(),function(){angular.module("resumeGame").directive("resumeGame",["UserService","GameService","$location",function(e,n,t){return{restrict:"E",scope:{},templateUrl:"assets/angular/resume-game/resume-game.html",link:function(r,i,o){r.user=e.getUser(),r.$watch(function(){return e.getUser()},function(e){r.user=e},!0),r.gameFiles=[],r.loadGameSummaries=function(){r.loadingGames=!0,r.retrievingError=!1,r.retrievingErrorMsg="",r.retryRetrieveAllowed=!1,n.getAllGameFileSummaries(r.user.uuid).then(function(e){r.gameFiles=e.data},function(e){var n;400===e.status?n="Your user ID is not loaded. Try signing out and logging back in.":404===e.status?n="Your user ID doesn't seem to match any in our records. Try signing out and logging back in.":(n="There was a problem retrieving your game files. Please try again in a moment.",r.retryRetrieveAllowed=!0),r.retrievingErrorMsg=n,r.retrievingError=!0}).finally(function(){r.loadingGames=!1})},r.loadGameSummaries(),r.submitSelectGameForm=function(){var e=r.selectGameForm;if(e.errorMsg="",e.$invalid)return void(e.errorMsg="Please select a game file");e.disableSubmitBtn=!0,n.loadGame(r.user.uuid,r.selectedGameId).then(function(){t.path("/game")},function(n){var t;t=400===n.status?"Something was missing from your request. Please make sure a game file is selected. If that doesn't work, try signing out and logging back in. If this issue persists, please file a bug report.":404===n.status?"That game file doesn't exist under your user ID. If this issue persists, please file a bug report.":"There was a problem while loading your game file. Please try again in a moment.",e.errorMsg=t}).finally(function(){e.disableSubmitBtn=!1})}}}}])}(),function(){angular.module("saveModal").directive("saveModal",["UserService","GameService",function(e,n){return{restrict:"E",templateUrl:"assets/angular/save-modal/save-modal.html",scope:{},link:function(t,r,i){t.user=e.getUser(),t.$watch(function(){return e.getUser()},function(e,n){e!==n&&(t.user=e)},!0),t.signOut=function(){e.signOut(),t.resetPage()},t.resetPage=function(){t.page=t.user.signedIn?"saveForm":"notSignedIn",t.prevPages=[]},t.isPage=function(e){return e===t.page},t.changePage=function(e){t.prevPages.unshift(t.page),t.page=e},t.goBack=function(){t.prevPages.length&&(t.page=t.prevPages.shift())},t.closeModal=function(){$(r).find(".modal").modal("hide")},t.saveFormData={},t.gameFiles=[],t.loadGameSummaries=function(){t.user.uuid?(t.loadingGames=!0,t.retrievingError=!1,t.retrievingErrorMsg="",t.retryRetrieveAllowed=!1,n.getAllGameFileSummaries(t.user.uuid).then(function(e){t.gameFiles=e.data},function(e){var n;400===e.status?n="Your user ID is not loaded. Try signing out and logging back in.":404===e.status?n="Your user ID doesn't seem to match any in our records. Try signing out and logging back in.":(n="There was a problem retrieving your game files. Please try again in a moment.",t.retryRetrieveAllowed=!0),t.retrievingErrorMsg=n,t.retrievingError=!0}).finally(function(){t.loadingGames=!1})):t.gameFiles=[]},t.submitSaveForm=function(){var e=t.saveForm;if(e.errorMsg="",e.$invalid)return void(e.errorMsg="Please select a game file");e.disableSubmitBtn=!0,n.saveGame(t.user.uuid,t.saveFormData.gameId).then(function(){t.closeModal(),t.saveFormData.gameId="",t.loadGameSummaries()},function(){e.errorMsg="An error occurred while saving your game. Please try again in a moment."}).finally(function(){e.disableSubmitBtn=!1})},t.resetPage(),t.loadGameSummaries(),$(r).find(".modal").on("show.bs.modal",function(e){t.$apply(function(){t.resetPage()})}),t.$watch(function(){return t.user.signedIn},function(e,n){e!==n&&(t.resetPage(),t.loadGameSummaries())},!0)}}}])}(),function(){angular.module("newGame").directive("newGame",["GameService","$location",function(e,n){return{restrict:"E",scope:{},templateUrl:"assets/angular/new-game/new-game.html",link:function(t,r,i){t.submitNewGameForm=function(){var r=t.newGameForm;if(r.errorMsg="",r.$invalid){var i,o=r.charName.$error;return o.required?i="You need to choose a name":o.pattern?i='Your character\'s name cannot contain any special characters besides " ", "-", "_", ".", and " \' "':o.maxlength&&(i="Your character's name cannot be over 20 characters"),void(r.errorMsg=i)}r.disableSubmitBtn=!0,e.loadNewGame(t.characterName).then(function(){n.path("/game")},function(e){var n;n=400===e.status?"You need to choose a name":"There was a problem loading your game. Please try again in a moment.",r.errorMsg=n}).finally(function(){r.disableSubmitBtn=!1})}}}}])}(),function(){angular.module("settingsModal").directive("settingsModal",["SettingsService","ZorkdaSounds",function(e,n){return{restrict:"E",templateUrl:"assets/angular/settings-modal/settings-modal.html",scope:{},link:function(t,r,i){t.playTestSound=function(){n.playSound("navi")},t.playTestTextScroll=function(){t.testText=[],t.testText=["Here is some text to demonstrate how fast the game text will scroll along the page."]},$("[data-toggle='popover']").popover(),t.testText=[],t.settings=e.getSettings(),t.$watch(function(){return e.getSettings()},function(e,n){e!==n&&e!==t.settings&&(t.settings=e)},!0)}}}])}(),function(){angular.module("signIn").directive("signIn",["UserService","$location","$routeParams",function(e,n,t){return{restrict:"E",scope:{redirect:"="},templateUrl:"assets/angular/sign-in/sign-in.html",link:function(r,i,o){r.$watch(function(){return e.getUser().signedIn},function(e){r.isSignedIn=e},!0),"sign-up-failure"===t.error&&(r.signInForm.errorMsg="You account was created successfully, but an error occurred while signing you in. Please try signing in again."),r.signIn=e.signIn,r.signOut=e.signOut,r.submitSignIn=function(){var e=r.signInForm;if(e.username.$setDirty(),e.password.$setDirty(),!e.$valid){var t,i=e.username.$error,o=e.password.$error;return t=i.pattern?'Your username cannot contain any special characters besides " ", "-", "_", and "."':i.maxlength?"Your username cannot be over 30 characters":o.maxlength?"Your password cannot be over 100 characters":"Please fill in all highlighted fields",void(e.errorMsg=t)}e.disableSubmitBtn=!0,e.errorMsg="",r.signIn(e.username.$modelValue,e.password.$modelValue).then(function(){r.redirect&&n.path("/")},function(n){var t,r=n.status;t=404===r?"That username is not in our records":422===r?"That password is incorrect":400===n.status?"Please fill in the highlighed fields":"An error occurred while processing your request. Please try again in a moment.",e.errorMsg=t}).finally(function(){e.disableSubmitBtn=!1})}}}}])}(),function(){angular.module("signUp").directive("comparewith",["$parse",function(e){return{require:"ngModel",link:function(n,t,r,i){var o=e(r.comparewith);i.$validators.comparewith=function(e){return e===o(n).$modelValue},n.$watch(r.comparewith,function(e,n){e!==n&&i.$validate()})}}}])}(),function(){angular.module("signUp").directive("signUp",["UserService","$location",function(e,n){return{restrict:"E",scope:{redirect:"="},templateUrl:"assets/angular/sign-up/sign-up.html",link:function(t,r,i){t.$watch(function(){return e.getUser().signedIn},function(e){t.isSignedIn=e},!0),t.signUp=e.signUp,t.signOut=e.signOut,t.signIn=e.signIn,t.signUpForm.passwordsMatch=function(){return t.signUpForm.password.$modelValue===t.signUpForm.passwordConf.$modelValue},t.submitSignUp=function(){var e=t.signUpForm;if(e.errorMsg="",e.username.$setDirty(),e.password.$setDirty(),e.passwordConf.$setDirty(),e.$valid){var r=e.username.$modelValue,i=e.password.$modelValue;e.disableSubmitBtn=!0,t.signUp(r,i).then(function(){t.redirect?n.path("/"):e.errorMsg="Your account was created successfully!"},function(n){var t;t=409===n.status?"That username is already taken":400===n.status?"Please fill in the highlighed fields":"An error occurred while processing your request. Please try again in a moment.",e.errorMsg=t}).finally(function(){e.disableSubmitBtn=!1})}else{if(e.passwordsMatch()){var o,a=e.username.$error,u=e.password.$error;return o=a.pattern?'Your username cannot contain any special characters besides " ", "-", "_", and "."':a.maxlength?"Your username cannot be over 30 characters":u.maxlength?"Your password cannot be over 100 characters":"Please fill in all highlighted fields",void(e.errorMsg=o)}e.errorMsg="Passwords do not match"}}}}}])}(),function(){angular.module("streamText").directive("streamText",["$interval","streamTextService",function(e,n){return{restrict:"A",scope:{textLines:"=",afterStream:"&"},template:"<span ng-bind-html='outputString'></span>",link:function(t,r,i){function o(){d&&l(),t.outputString="",m=0,g=0,s()}function a(){l(),t.afterStream&&t.afterStream()}function u(){if(m>=t.textLines.length)return void a();var e=t.textLines[m];if(g>=e.length)return t.outputString+="<br>",m+=1,g=0,void u();t.outputString+=e[g],g++}function s(){d=e(function(){u()},f)}function c(){d&&(l(),d=e(function(){u()},f))}function l(){e.cancel(d),d=null}var m,g,d;t.outputString="";var f=n.getDelay();t.$watch(function(){return n.getDelay()},function(e,n){e!==n&&(f=e,c())}),o(),t.$watch(function(){return t.textLines},function(e,n){e!==n&&o()}),r.on("$destroy",function(){d&&l()})}}}])}(),function(){angular.module("streamText").factory("streamTextService",[function(){function e(e){return.1*(1-e/10)*1e3}var n=5,t=e(n);return{getSpeed:function(){return n},getDelay:function(){return t},setSpeed:function(r){r<1?r=1:r>10&&(r=10),n=r,t=e(r)}}}])}(),angular.module("ngAudio",[]).directive("ngAudio",["$compile","$q","ngAudio",function(e,n,t){return{restrict:"AEC",scope:{volume:"=",start:"=",currentTime:"=",loop:"=",clickPlay:"=",disablePreload:"="},controller:function(e,n,r,i){function o(){a=t.load(n.ngAudio),e.$audio=a,a.unbind()}var a;e.disablePreload||o(),r.on("click",function(){e.clickPlay!==!1&&(e.disablePreload&&o(),a.audio.play(),a.volume=e.volume||a.volume,a.loop=e.loop,a.currentTime=e.start||0,i(function(){a.play()},5))})}}}]).directive("ngAudioHover",["$compile","$q","ngAudio",function(e,n,t){return{restrict:"AEC",controller:function(e,n,r,i){var o=t.load(n.ngAudioHover);r.on("mouseover rollover hover",function(){o.audio.play(),o.volume=n.volumeHover||o.volume,o.loop=n.loop,o.currentTime=n.startHover||0})}}}]).service("localAudioFindingService",["$q",function(e){this.find=function(n){var t=e.defer(),r=document.getElementById(n);return r?t.resolve(r):t.reject(n),t.promise}}]).service("remoteAudioFindingService",["$q",function(e){this.find=function(n){var t=e.defer(),r=new Audio;return r.addEventListener("error",function(){t.reject()}),r.addEventListener("loadstart",function(){t.resolve(r)}),setTimeout(function(){r.src=n},1),t.promise}}]).service("cleverAudioFindingService",["$q","localAudioFindingService","remoteAudioFindingService",function(e,n,t){this.find=function(r){var i=e.defer();return r=r.replace("|","/"),n.find(r).then(i.resolve,function(){return t.find(r)}).then(i.resolve,i.reject),i.promise}}]).value("ngAudioGlobals",{muting:!1,songmuting:!1,performance:25,unlock:!0}).factory("NgAudioObject",["cleverAudioFindingService","$rootScope","$interval","$timeout","ngAudioGlobals",function(e,n,t,r,i){return function(r){function o(){u=n.$watch(function(){return{volume:b.volume,currentTime:b.currentTime,progress:b.progress,muting:b.muting,loop:b.loop,playbackRate:b.playbackRate}},function(e,n){e.currentTime!==n.currentTime&&b.setCurrentTime(e.currentTime),e.progress!==n.progress&&b.setProgress(e.progress),e.volume!==n.volume&&b.setVolume(e.volume),e.playbackRate!==n.playbackRate&&b.setPlaybackRate(e.playbackRate),c=e.loop,e.muting!==n.muting&&b.setMuting(e.muting)},!0)}function a(){u&&u(),l&&(v||i.isMuting?l.volume=0:l.volume=void 0!==b.volume?b.volume:1,m&&(l.play(),m=!1),d&&(l.pause(),l.currentTime=0,d=!1),g&&(l.pause(),g=!1),f&&(l.playbackRate=p,f=!1),s&&(l.volume=s,s=void 0),h&&(b.currentTime=l.currentTime,b.duration=l.duration,b.remaining=l.duration-l.currentTime,b.progress=l.currentTime/l.duration,b.paused=l.paused,b.src=l.src,b.currentTime>=b.duration&&w.forEach(function(e){e(b)}),c&&b.currentTime>=b.duration&&(c!==!0&&(c--,b.loop--),b.setCurrentTime(0),b.play())),v||i.isMuting||(b.volume=l.volume),b.audio=l),o()}i.unlock&&window.addEventListener("click",function e(){l.play(),l.pause(),window.removeEventListener("click",e)});var u,s,c,l,m=!1,g=!1,d=!1,f=!1,p=!1,v=!1,h=!0,b=this;this.id=r,this.safeId=r.replace("/","|"),this.loop=0,this.unbind=function(){h=!1},this.play=function(){return m=!0,this};var w=[];this.complete=function(e){w.push(e)},this.pause=function(){g=!0},this.restart=function(){d=!0},this.stop=function(){this.restart()},this.setVolume=function(e){s=e},this.setPlaybackRate=function(e){p=e,f=!0},this.setMuting=function(e){v=e},this.setProgress=function(e){l&&l.duration&&isFinite(e)&&(l.currentTime=l.duration*e)},this.setCurrentTime=function(e){l&&l.duration&&(l.currentTime=e)},e.find(r).then(function(e){l=e,l.addEventListener("canplay",function(){b.canPlay=!0})},function(e){b.error=!0,console.warn(e)});var y=t(a,i.performance);n.$watch(function(){return i.performance},function(){t.cancel(y),y=t(a,i.performance)})}}]).service("ngAudio",["NgAudioObject","ngAudioGlobals",function(e,n){this.play=function(n){var t=new e(n);return t.play(),t},this.load=function(n){return new e(n)},this.mute=function(){n.muting=!0},this.unmute=function(){n.muting=!1},this.toggleMute=function(){n.muting=!n.muting},this.setUnlock=function(e){n.unlock=e}}]).filter("trackTime",function(){return function(e){var n=Math.floor(0|e),t="",r=0,i=0,o=0;return n>3599?(r=Math.floor(n/3600),i=Math.floor((n-3600*r)/60),o=n-(60*i+3600*r),1==r.toString().length&&(r="0"+Math.floor(n/3600).toString()),1==i.toString().length&&(i="0"+Math.floor((n-3600*r)/60).toString()),1==o.toString().length&&(o="0"+(n-(60*i+3600*r)).toString()),t=r+":"+i+":"+o):n>59?(i=Math.floor(n/60),o=n-60*i,1==i.toString().length&&(i="0"+Math.floor(n/60).toString()),1==o.toString().length&&(o="0"+(n-60*i).toString()),t=i+":"+o):(o=n,1==o.toString().length&&(o="0"+n.toString()),t=n+"s"),Number.isNaN(t),t}}),"object"==typeof module&&module.exports&&(module.exports="luegg.directives"),function(e,n){function t(e,t,r){if(""!==t){var i=e(t);return i.assign!==n?function(e,n,t){return{getValue:function(){return e(t)},setValue:function(r){r!==e(t)&&t.$apply(function(){n(t,r)})}}}(i,i.assign,r):function(e,n){return{getValue:function(){return e(n)},setValue:function(){}}}(i,r)}return function(e){var n=e;return{getValue:function(){return n},setValue:function(e){n=e}}}(!0)}function r(n,r,i){n.directive(r,["$parse","$window","$timeout",function(n,o,a){return{priority:1,restrict:"A",link:function(u,s,c){function l(){d.getValue()&&!i.isAttached(g)&&a(function(){i.scroll(g)})}function m(){d.setValue(i.isAttached(g))}var g=s[0],d=t(n,c[r],u);a(l,0,!1),s[0].hasAttribute("force-glue")||s.on("scroll",m);var f=!1;e.forEach(s.children(),function(e){e.hasAttribute("scroll-glue-anchor")&&(f=!0,u.$watch(function(){return e.offsetHeight},function(){l()}))}),f||(u.$watch(l),o.addEventListener("resize",l,!1)),s.on("$destroy",function(){s.unbind("scroll",m)}),u.$on("$destroy",function(){o.removeEventListener("resize",l,!1)})}}}])}var i={isAttached:function(e){return e.scrollTop+e.clientHeight+1>=e.scrollHeight},scroll:function(e){e.scrollTop=e.scrollHeight}},o={isAttached:function(e){return e.scrollTop<=1},scroll:function(e){e.scrollTop=0}},a={isAttached:function(e){return e.scrollLeft+e.clientWidth+1>=e.scrollWidth},scroll:function(e){e.scrollLeft=e.scrollWidth}},u={isAttached:function(e){return e.scrollLeft<=1},scroll:function(e){e.scrollLeft=0}},s=e.module("luegg.directives",[]);r(s,"scrollGlue",i),r(s,"scrollGlueTop",o),r(s,"scrollGlueBottom",i),r(s,"scrollGlueLeft",u),r(s,"scrollGlueRight",a)}(angular),function(){angular.module("zorkdaSounds").factory("ZorkdaSounds",["ngAudio",function(e){var n={navi:e.load("assets/sounds/navi-hey.wav")};return{playSound:function(e){n[e].play()},setVolume:function(e){$.each(n,function(n,t){t.volume=e})}}}])}(),function(){angular.module("splashPage").directive("splashPage",["UserService",function(e){return{restrict:"E",templateUrl:"assets/angular/splash-page/splash-page.html",scope:{},transclude:!0,link:function(n,t,r){n.$watch(function(){return e.getUser()},function(e){n.user=e},!0)}}}])}(),function(){angular.module("core").directive("autofocus",["$document","$timeout",function(e,n){return{link:function(e,t,r){n(function(){t[0].focus()},100)}}}])}(),function(){angular.module("core").factory("GameService",["$cookies","$rootScope","$http",function(e,n,t){function r(){c=$.extend(!0,{},s)}function i(){a(c)}function o(){return e.getObject("game")}function a(n){e.putObject("game",n)}function u(e,n){c={loaded:!0,gameSessionId:e,saved:!0,savedGameId:n}}var s={loaded:!1,gameSessionId:null,saved:!0,savedGameId:null};void 0===o()&&function(){a($.extend(!0,{},s))}();var c;return function(){c=$.extend(!0,{},o())}(),n.$watch(function(){return c},function(e,n){e===n||angular.equals(e,o())||i()},!0),{getGame:function(){return c},quitGame:function(){r()},startGame:function(){c.saved=!1;var e=t.post("/game/start",{gameSessionId:c.gameSessionId},{responseType:"json",timeout:2e4});return e.then(function(e){c.loaded=!0}),e},submitInput:function(e){return c.saved=!1,t.post("/game/input",{gameSessionId:c.gameSessionId,input:e},{responseType:"json",timeout:2e4})},saveGame:function(e,n){var r,i=c.gameSessionId;return r="new"===n?t.post("/game/save-new",{uuid:e,gameSessionId:i},{responseType:"json",timeout:2e4}):t.post("/game/save",{uuid:e,gameSessionId:i,saveGameId:n},{responseType:"json",timeout:2e4}),r.then(function(e){c.saved=!0,c.savedGameId=e.data.savedGameId}),r},loadGame:function(e,n){var r=t.post("/game/load",{uuid:e,savedGameId:n},{responseType:"json",timeout:2e4});return r.then(function(e){u(e.data.gameSessionId,e.data.savedGameId)}),r},loadNewGame:function(e){var n=t.post("/game/load-new",{protagonistName:e},{responseType:"json",timeout:2e4});return n.then(function(e){u(e.data.gameSessionId,null)}),n},getAllGameFileSummaries:function(e){return t.post("/user/game-summaries",{uuid:e},{responseType:"json",timeout:2e4})}}}])}(),function(){angular.module("core").component("loadingIcon",{templateUrl:"assets/angular/core/loading-icon/loading-icon.html"})}(),function(){angular.module("core").directive("radioDetectChange",function(){return{replace:!1,require:"ngModel",scope:!1,link:function(e,n,t,r){n.on("change",function(){e.$apply(function(){r.$setViewValue("radio"==n[0].type.toLowerCase()?n[0].value:n[0].checked)})})}}})}(),function(){angular.module("core").factory("UserService",["$cookies","$http","GameService",function(e,n,t){function r(){s=$.extend(!0,{},o())}function i(){a({username:null,signedIn:!1,uuid:null})}function o(){return e.getObject("user")}function a(n){e.putObject("user",n)}function u(e,n){a({username:e,signedIn:!0,uuid:n}),r()}void 0===o()&&i();var s;return r(),{getUser:function(){return s},signOut:function(){t.quitGame(),i(),r()},signIn:function(e,t){var r=n.post("/user/sign-in",{username:e,password:t},{responseType:"json",timeout:8e3});return r.then(function(e){u(e.data.username,e.data.uuid)}),r},signUp:function(e,t){var r=n.post("/user/sign-up",{username:e,password:t},{responseType:"json",timeout:1e4});return r.then(function(e){u(e.data.username,e.data.uuid)}),r}}}])}(),function(){angular.module("core").factory("SettingsService",["$cookies","$rootScope","ZorkdaSounds","streamTextService",function(e,n,t,r){function i(){a(s)}function o(){return e.getObject("settings")}function a(n){e.putObject("settings",n)}var u={volume:.5,textSpeed:7};void 0===o()&&function(){a($.extend(!0,{},u))}();var s;return function(){s=$.extend(!0,{},o())}(),t.setVolume(s.volume),r.setSpeed(s.textSpeed),n.$watch(function(){return s},function(e,n){e.volume!==n.volume&&t.setVolume(e.volume),e.textSpeed!==n.textSpeed&&r.setSpeed(e.textSpeed),e===n||angular.equals(e,o())||i()},!0),{getSettings:function(){return s},setAllSettings:function(e){s=e},resetAllSettings:function(){s=$.extend(!0,{},u)}}}])}(),function(){angular.module("zorkdaForm").directive("formGroupHoriz",function(){return{restrict:"E",scope:{label:"@",animation:"@",required:"="},transclude:!0,templateUrl:"assets/angular/zorkda-form/form-group-horiz/form-group-horiz.html"}})}(),function(){angular.module("zorkdaForm").directive("submitBtn",function(){return{restrict:"E",scope:{label:"@",isDisabled:"="},templateUrl:"assets/angular/zorkda-form/submit-btn/submit-btn.html"}})}();